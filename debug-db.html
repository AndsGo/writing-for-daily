<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®åº“è°ƒè¯•å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 { color: #333; }
    .section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .section h2 {
      margin-top: 0;  
      color: #4a90e2;
    }
    .record {
      background: #f5f5f5;
      padding: 10px;
      margin: 10px 0;
      border-radius: 3px;
    }
    .record strong { color: #333; }
    .record .time { color: #666; font-size: 12px; }
    button {
      padding: 10px 20px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #357abd; }
    .highlight { background: #fff3cd; padding: 2px 5px; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>ğŸ” æ•°æ®åº“è°ƒè¯•å·¥å…·</h1>
  
  <div class="section">
    <h2>æ“ä½œ</h2>
    <button onclick="checkAllRecords()">æŸ¥çœ‹æ‰€æœ‰è®°å½•</button>
    <button onclick="checkCurrentMonth()">æŸ¥çœ‹å½“å‰æœˆè®°å½•</button>
    <button onclick="checkDateRange()">æ£€æŸ¥æ—¥æœŸèŒƒå›´</button>
    <button onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
  </div>

  <div class="section">
    <h2>ç³»ç»Ÿä¿¡æ¯</h2>
    <div id="systemInfo"></div>
  </div>

  <div class="section">
    <h2>æŸ¥è¯¢ç»“æœ</h2>
    <div id="results"></div>
  </div>

  <script type="module">
    import Dexie from 'https://cdn.jsdelivr.net/npm/dexie@3.2.4/dist/dexie.mjs';

    class EnglishLearningDB extends Dexie {
      translations;
      progress;
      dailySummaries;

      constructor() {
        super('EnglishLearningDB');
        this.version(1).stores({
          translations: '++id,createdAt,category,isFavorite',
          progress: 'id',
          dailySummaries: '++id,date'
        });
      }
    }

    const db = new EnglishLearningDB();

    function displaySystemInfo() {
      const now = new Date();
      const info = `
        <p><strong>å½“å‰æ—¶é—´:</strong> ${now.toLocaleString()}</p>
        <p><strong>å½“å‰æ—¶åŒº:</strong> ${Intl.DateTimeFormat().resolvedOptions().timeZone}</p>
        <p><strong>UTCåç§»:</strong> ${now.getTimezoneOffset()} åˆ†é’Ÿ</p>
        <p><strong>å½“å‰å¹´ä»½:</strong> ${now.getFullYear()}</p>
        <p><strong>å½“å‰æœˆä»½:</strong> ${now.getMonth() + 1}</p>
        <p><strong>å½“å‰æ—¥æœŸ:</strong> ${now.getDate()}</p>
      `;
      document.getElementById('systemInfo').innerHTML = info;
    }

    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function displayRecords(records, title) {
      let html = `<h3>${title} (${records.length} æ¡è®°å½•)</h3>`;
      
      if (records.length === 0) {
        html += '<p class="error">æ²¡æœ‰æ‰¾åˆ°è®°å½•</p>';
      } else {
        records.forEach(record => {
          const createdDate = new Date(record.createdAt);
          const localDate = formatDate(createdDate);
          html += `
            <div class="record">
              <strong>ID:</strong> ${record.id}<br>
              <strong>ä¸­æ–‡:</strong> ${record.chineseText}<br>
              <strong>è‹±æ–‡:</strong> ${record.englishText}<br>
              <strong>åˆ†ç±»:</strong> ${record.category}<br>
              <div class="time">
                <strong>UTCæ—¶é—´:</strong> ${record.createdAt}<br>
                <strong>æœ¬åœ°æ—¶é—´:</strong> ${createdDate.toLocaleString()}<br>
                <strong>æ—¥æœŸå­—ç¬¦ä¸²:</strong> <span class="highlight">${localDate}</span>
              </div>
            </div>
          `;
        });
      }
      
      document.getElementById('results').innerHTML = html;
    }

    async function checkAllRecords() {
      console.log('=== æŸ¥çœ‹æ‰€æœ‰è®°å½• ===');
      const records = await db.translations.toArray();
      console.log('æ€»è®°å½•æ•°:', records.length);
      console.log('æ‰€æœ‰è®°å½•:', records);
      displayRecords(records, 'æ‰€æœ‰è®°å½•');
    }

    async function checkCurrentMonth() {
      console.log('=== æŸ¥çœ‹å½“å‰æœˆè®°å½• ===');
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      
      const startOfMonth = new Date(year, month, 1);
      const endOfMonth = new Date(year, month + 1, 0, 23, 59, 59, 999);
      
      console.log('æŸ¥è¯¢èŒƒå›´(æœ¬åœ°):', {
        start: startOfMonth.toLocaleString(),
        end: endOfMonth.toLocaleString()
      });
      console.log('æŸ¥è¯¢èŒƒå›´(ISO):', {
        start: startOfMonth.toISOString(),
        end: endOfMonth.toISOString()
      });
      
      const records = await db.translations
        .where('createdAt')
        .between(startOfMonth.toISOString(), endOfMonth.toISOString())
        .toArray();
      
      console.log('æŸ¥è¯¢åˆ°çš„è®°å½•æ•°:', records.length);
      console.log('æŸ¥è¯¢åˆ°çš„è®°å½•:', records);
      displayRecords(records, 'å½“å‰æœˆè®°å½•');
    }

    async function checkDateRange() {
      console.log('=== æ£€æŸ¥ç‰¹å®šæ—¥æœŸèŒƒå›´ ===');
      
      const testDate = '2025-12-27';
      const startDate = new Date(testDate + 'T00:00:00');
      const endDate = new Date(testDate + 'T23:59:59');
      
      console.log('æµ‹è¯•æ—¥æœŸ:', testDate);
      console.log('æŸ¥è¯¢èŒƒå›´(æœ¬åœ°):', {
        start: startDate.toLocaleString(),
        end: endDate.toLocaleString()
      });
      console.log('æŸ¥è¯¢èŒƒå›´(ISO):', {
        start: startDate.toISOString(),
        end: endDate.toISOString()
      });
      
      const records = await db.translations
        .where('createdAt')
        .between(startDate.toISOString(), endDate.toISOString())
        .toArray();
      
      console.log('æŸ¥è¯¢åˆ°çš„è®°å½•æ•°:', records.length);
      console.log('æŸ¥è¯¢åˆ°çš„è®°å½•:', records);
      displayRecords(records, `æ—¥æœŸ ${testDate} çš„è®°å½•`);
    }

    function clearConsole() {
      console.clear();
      document.getElementById('results').innerHTML = '';
    }

    window.checkAllRecords = checkAllRecords;
    window.checkCurrentMonth = checkCurrentMonth;
    window.checkDateRange = checkDateRange;
    window.clearConsole = clearConsole;

    displaySystemInfo();
    console.log('æ•°æ®åº“è°ƒè¯•å·¥å…·å·²åŠ è½½');
    console.log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥æ•°æ®');
  </script>
</body>
</html>
